function buildElement(e,t,n){"use strict";var i=stripe.elements({locale:t.locale}),r=n.styles.card_element,o=i.create("card",{iconStyle:"solid",style:{base:{iconColor:r.iconColor,color:r.color,fontWeight:r.fontWeight,fontFamily:r.fontFamily,fontSize:r.fontSize,fontSmoothing:"antialiased","::placeholder":{color:r.placeholderColor},":-webkit-autofill":{color:r.webkitAutofillColor}},invalid:{iconColor:r.invalidIconColor,color:r.invalidColor}}});o.mount("#ds-element-"+e+"-card"),registerElements([o],"ds-element-"+e)}function stripe_checkout(e,t,n,i){var r=t,o=r.type;if("donation"===o)var s=setDonationValue(r.instance);else s=r.amount;jQuery.post(t.ajaxurl,{action:"ds_process_button",stripeToken:e.id,paymentMethodID:i,allData:n,type:o,amount:s,params:r,ds_nonce:r.ds_nonce},function(e){handleServerResponse(e,t)})}function handleServerResponse(e,t){if(e.requires_source_action)switch(e.action_type){case"incomplete":stripe.handleCardPayment(e.payment_intent_client_secret).then(function(e){processResult(e,t)});break;case"requires_source_action":stripe.handleCardAction(e.payment_intent_client_secret).then(function(e){processResult(e,t)});break;default:processResult(e,t)}else"object"==typeof e&&void 0!==e.id?displayFinalResult(e,t):processResult(e,t)}function processResult(e,t){void 0!==e.paymentIntent?"requires_confirmation"===e.paymentIntent.status?jQuery.post(t.ajaxurl,{action:"ds_process_button",paymentIntentID:e.paymentIntent.id,params:t,ds_nonce:t.ds_nonce},function(e){displayFinalResult(e,t)}):"succeeded"===e.paymentIntent.status&&jQuery.post(t.ajaxurl,{action:"ds_process_button",paymentIntentSucceeded:e.paymentIntent,params:t,ds_nonce:t.ds_nonce},function(e){displayFinalResult(e,t)}):displayFinalResult(e,t)}function displayFinalResult(e,t){var n=document.querySelector(".ds-element-"+t.instance),i=document.querySelector("#ds-success-answer-"+t.instance),r=document.querySelector("#ds-error-answer-"+t.instance);switch(e.id){case"1":n.classList.remove("submitting"),n.classList.add("submitted"),jQuery(i).html(e.message);break;case"2":n.classList.remove("submitting"),n.classList.add("submitted"),window.location.assign(e.url);break;default:n.classList.remove("submitting"),n.classList.add("error"),void 0!==e.error?jQuery(r).html(e.error.message):void 0!==e.message&&jQuery(r).html(e.message)}}jQuery(".direct-stripe-button-id").on("click",function(e){var t=jQuery(this).data("id");if(t.length<=0)console.log("DS instance button missing");else{0<jQuery(".donationvalue").length&&setDonationValue(t);var n=window[t],i=direct_stripe_script_vars;if(""!==n.currency)n.currency;else n.general_currency;"1"===n.billing||n.billing,"1"===n.shipping||n.shipping,"1"===n.rememberme||n.rememberme;var r="#ds-pre-answer-"+t;if(""!==n.display_amount&&"subscription"!==n.type&&"donation"!==n.type)parseInt(n.original_amount);else if(""!==n.display_amount&&"donation"===n.type)if("1"===n.zero_decimal||"true"===n.zero_decimal)parseInt(n.original_amount);else parseFloat(100*n.original_amount);else;var o=checkTC(this,t),s=checkDonationInput(this,n,/^\+?[0-9]*\.?[0-9]+$/);if(o)return returnError(r,i,"emptyTc"),!1;if(s)return returnError(r,i,"emptyDonation"),!1;buildElement(t,n,i),ds.modal.open(t),e.preventDefault()}}),window.addEventListener("popstate",function(){handler.close()});var stripe=Stripe(direct_stripe_script_vars.p_key);function registerElements(g,S){var e="."+S,k=document.querySelector(e),q=k.querySelector("form"),i=q.querySelector(".error"),r=i.querySelector(".message"),t=jQuery(q).data("id"),j=window[t],n=k.querySelector("a.reset-success-"+t),o=k.querySelector("a.reset-error-"+t);function w(){Array.prototype.forEach.call(q.querySelectorAll("input[type='text'], input[type='email'], input[type='tel']"),function(e){e.removeAttribute("disabled")})}var s={};function a(e,t,n,i){e.reset(),t.forEach(function(e){e.clear()}),i.classList.remove("visible"),n.classList.remove("error"),w(),n.classList.remove("submitted")}g.forEach(function(e,n){e.on("change",function(e){if(e.error)i.classList.add("visible"),s[n]=e.error.message,r.innerText=e.error.message;else{s[n]=null;var t=Object.keys(s).sort().reduce(function(e,t){return e||s[t]},null);t?r.innerText=t:i.classList.remove("visible")}})}),q.addEventListener("submit",function(e){e.preventDefault();var t,n=!0;if(Array.prototype.forEach.call(q.querySelectorAll("input"),function(e){!e.checkValidity||e.checkValidity()||(n=!1)}),!n)return(t=document.createElement("input")).type="submit",t.style.display="none",q.appendChild(t),t.click(),void t.remove();k.classList.add("submitting"),Array.prototype.forEach.call(q.querySelectorAll("input[type='text'], input[type='email'], input[type='tel']"),function(e){e.setAttribute("disabled","true")});var i=q.querySelector("#"+S+"-name"),r=q.querySelector("#"+S+"-email"),o=q.querySelector("#"+S+"-phone"),s=q.querySelector("#"+S+"-address"),a=q.querySelector("#"+S+"-city"),l=q.querySelector("#"+S+"-state"),c=q.querySelector("#"+S+"-zip"),u=q.querySelector("#"+S+"-country"),d={name:i?i.value:void 0,email:r?r.value:void 0,phone:o?o.value:void 0,address:{line1:s?s.value:void 0,city:a?a.value:void 0,state:l?l.value:void 0,postal_code:c?c.value:void 0,country:u?u.value:void 0}},p=q.querySelector("#"+S+"-sh-name"),m=q.querySelector("#"+S+"-sh-phone"),y=q.querySelector("#"+S+"-sh-address"),v=q.querySelector("#"+S+"-sh-city"),h=q.querySelector("#"+S+"-sh-state"),f=q.querySelector("#"+S+"-sh-zip"),_=q.querySelector("#"+S+"-sh-country"),b={billingDetails:d,shippingDetails:{name:p?p.value:void 0,phone:m?m.value:void 0,line1:y?y.value:void 0,city:v?v.value:void 0,state:h?h.value:void 0,postal_code:f?f.value:void 0,country:_?_.value:void 0}};stripe.createPaymentMethod("card",g[0],{billing_details:d}).then(function(t){t.error?(w(),displayFinalResult(t,j)):stripe.createToken(g[0],{}).then(function(e){e.token&&stripe_checkout(e.token,j,b,t.paymentMethod.id)})})}),o.addEventListener("click",function(e){e.preventDefault(),a(q,g,k,i)}),n.addEventListener("click",function(e){e.preventDefault(),a(q,g,k,i)})}var ds=window.ds||{};function setDonationValue(e){var t=window[e];return t.original_amount=jQuery("#donationvalue-"+e).val(),jQuery(".dsDonationValue-"+e).val(t.original_amount),jQuery(".ds-modal-button-"+e+" > .ds-modal-amount").html(t.original_amount),t.original_amount}function checkTC(e,t){return jQuery(e).hasClass("ds-check-tc")&&!jQuery("#ds-conditions-"+t).is(":checked")}function checkDonationInput(e,t,n){return jQuery(e).hasClass("ds-check-donation")&&!t.original_amount&&!t.original_amount.match(n)}function returnError(e,t,n){"emptyTc"===n?text=t.text.checkTC:"emptyDonation"===n&&(text=t.text.enterAmount),jQuery(e).html(text+"<br/>"),jQuery(e).addClass("error"),jQuery(e).show(),setTimeout(function(){jQuery(e).hide()},1e4)}ds.modal={instances:[],initInstance:function(t){if(this.instances[t])return this.instances[t];this.instances[t]=jQuery("#modal-"+t);var e=this.instances[t].find(".ds-close");return this.instances[t].appendTo("body"),e.on("click",function(e){e.preventDefault(),this.instances[t].hide()}.bind(this)),window.onclick=function(e){e.target==this.instances[t][0]&&this.instances[t].hide()}.bind(this),this.instances[t]},open:function(e){ds.modal.instances[e]||ds.modal.initInstance(e),ds.modal.instances[e].show()},close:function(e){ds.modal.instances[e]&&ds.modal.instances[e].hide()}};